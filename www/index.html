<!DOCTYPE html>
<!--
    Copyright (c) ivonne . All rights reserved.

-->
<html>
  <head>
    <title>Geolocalización </title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script src="lib/jquery/jquery.mobile-1.4.5.min.js"></script>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
	<link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
	<script type="text/javascript" src="lib/gmaps.js"></script> 
    <script type="text/javascript" charset="utf-8">
		

		function onSuccess(position) {
		var element = document.getElementById('geolocation');

			
			initialize(position.coords.latitude,position.coords.longitude);
			
		
		}
	function initialize(lat,log) {
			/*la informacion esta sacada desde la misma web (https://developers.google.com/maps/documentation/javascript/geocoding?hl=es#GeocodingResponses)*/
				var geocoder;
				var map;
				var infowindow = new google.maps.InfoWindow();	
				var element = document.getElementById('resultado');
				var latlng = new google.maps.LatLng(lat,log);
				var mapOptions = {
				zoom: 15,
				center: latlng,
				mapTypeId: 'roadmap'
			  }
			 
				map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
				geocoder = new google.maps.Geocoder();
				geocoder.geocode({"latLng": latlng}, function(results, status)
			{
				
				if (status == google.maps.GeocoderStatus.OK)
				{
					if (results[0]) 
					{ 
					
						dir = "<p><strong>Dirección: </strong>" + results[0].formatted_address + "</p>";
						dir += '<p><strong>address_components.short_name:</strong>'+results[0].address_components[0]['short_name']+'</p>';
						dir += '<p><strong>address_components.short_name:</strong>'+results[0].address_components[0]['long_name']+'</p>';
						dir += '<p><strong>place id:</strong>'+results[0].place_id+'</p>';
						/*Por ahora son las que  he podido sacar de variables que se supone que son todas estass
						results[]: {
							 types[]: string,
							 formatted_address: string,
							 address_components[]: {
							   short_name: string,
							   long_name: string,
							   postcode_localities[]: string,
							   types[]: string
							 },
							 partial_match: boolean,
							 place_id: string,
							 postcode_localities[]: string,
							 geometry: {
							   location: LatLng,
							   location_type: GeocoderLocationType
							   viewport: LatLngBounds,
							   bounds: LatLngBounds
							 }
							}
						*/
					
					}
					else
					{
						dir = "<p>No se ha podido obtener ninguna dirección en esas coordenadas.</p>";
					}
				}
				else
				{
					dir = "<p>El Servicio de Codificación Geográfica ha fallado con el siguiente error: " + status + ".</p>";
				}

				element.innerHTML = "<p>" + dir + '</p>';
			});
	
			    var marker = new google.maps.Marker({
					position: latlng,
					map: map,
					title: 'Hello World!'
				  });

			  
			}

	function onError(error) {
		alert('code: '    + error.code    + '\n' +
			  'message: ' + error.message + '\n');
	}

	// Options: throw an error if no update is received every 30 seconds.
	
	//
		//var watchID = navigator.geolocation.watchPosition(onSuccess, onError, {maximumAge: 60000, timeout: 5000, enableHighAccuracy: true }); // esta me mira cada moment0
		var watchID = navigator.geolocation.getCurrentPosition(onSuccess, onError, {maximumAge: 30000, timeout: 5000, enableHighAccuracy: true }); // esta me mira una vez
	//var watchID = navigator.geolocation.watchPosition(onSuccess, onError, 500000);
	 function clearWatch() { 
		var watchID = navigator.geolocation.getCurrentPosition(onSuccess, onError, {maximumAge: 30000, timeout: 5000, enableHighAccuracy: true }); 
        if (watchID != null) {
            navigator.geolocation.clearWatch(watchID);
            watchID = null;
        }
		alert('ss');
    }
	 function calc2points() { 
		var watchID = navigator.geolocation.getCurrentPosition(onSuccess, onError, {maximumAge: 30000, timeout: 5000, enableHighAccuracy: true }); 
		var x1=new google.maps.LatLng(50.995093,-16.417091);
		var x2=new google.maps.LatLng(50.997698,-16.41788);
		var distancia = google.maps.geometry.spherical.computeDistanceBetween(x1, x2);
		alert(distancia);
    }

	
	



    </script>
	<style>
	 #map-canvas{
	   height:200px;
	   
	 }
	</style>
  </head>
  <body>
   
    <p id="resultado"></p>
	  <button onclick="clearWatch();">Volver a ubicar</button>
	      <div id="map-canvas">
                                        
          </div>
	<button onclick="calc2points" >Calcular distancia entre dos puntos</button>
	
<script>

    
    

</script>
  </body>
</html>


